#!/usr/bin/env python
# encoding: utf-8

APPNAME = 'something'
VERSION = ''


def options(opt):
	opt.load('compiler_cxx')


def configure(conf):
	conf.load('compiler_cxx')
	ctx.find_program('autorevision', var='AUTOREVISION')


def build(bld):
	autorevision_cache_node = bld.path.make_node('autorevision.cache')

	bld(
		name='autorevision',
		rule='autorevision -s VCS_TAG -o ${TGT[0].abspath()}',
		target=autorevision_cache_node,
		always=True,
		update_outputs = True)

	bld(
		after='autorevision',
		rule='${AUTOREVISION} -f -t json -o ${SRC} > ${TGT}',
		source=autorevision_cache_node,
		target='autorevision.json')

	bld(
		after='autorevision',
		rule='${AUTOREVISION} -f -t h -o ${SRC} > ${TGT}',
		source=autorevision_cache_node,
		target='autorevision.h')

	bld.program(
		source='example.cpp',
		target='app',
		cxxflags='-std=c++11')
